# clab-evpn1-spine1
/ interface ethernet-1/1 subinterface 0 ipv4 address 172.16.11.2/24
/ interface ethernet-1/2 subinterface 0 ipv4 address 172.16.12.2/24
/ interface ethernet-1/3 subinterface 0 ipv4 address 172.16.13.2/24
/ network-instance default admin-state enable
/ network-instance default interface ethernet-1/1.0
/ network-instance default interface ethernet-1/2.0
/ network-instance default interface ethernet-1/3.0
/interface ethernet-1/1 subinterface 0 ipv4 admin-state enable
/interface ethernet-1/2 subinterface 0 ipv4 admin-state enable
/interface ethernet-1/3 subinterface 0 ipv4 admin-state enable
/ routing-policy {
  policy all {
    default-action {
      policy-result accept
    }
  }
}
/ network-instance default protocols
bgp {
  autonomous-system 65000
  router-id 10.0.1.1
  group underlay {
    export-policy all
    import-policy all
    afi-safi ipv4-unicast {
      admin-state enable
    }
    afi-safi evpn {
      admin-state disable
    }
  }
  neighbor 172.16.11.1 {
    peer-as 65101
    peer-group underlay
  }
  neighbor 172.16.12.1 {
    peer-as 65102
    peer-group underlay
  }
  neighbor 172.16.13.1 {
    peer-as 65103
    peer-group underlay
  }
  afi-safi ipv4-unicast {
    admin-state enable
  }
  
  group overlay {
    export-policy all
    import-policy all
    peer-as 100
    local-as as-number 100
    afi-safi ipv4-unicast {
      admin-state disable
    }
    afi-safi evpn {
      admin-state enable
    }
    route-reflector {
      client true
      cluster-id 10.0.1.1
    }
  }
  neighbor 10.0.0.1 {
    peer-group overlay
  }
  neighbor 10.0.0.2 {
    peer-group overlay
  }
  neighbor 10.0.0.3 {
    peer-group overlay
  }
}
/ interface system0 {
  admin-state enable
  subinterface 0 {
    admin-state enable
    ipv4 {
      admin-state enable
      address 10.0.1.1/32 {
      }
    }
  }
}
/ network-instance default interface system0.0

# clab-evpn1-spine2
/ interface ethernet-1/1 subinterface 0 ipv4 address 172.16.21.2/24
/ interface ethernet-1/2 subinterface 0 ipv4 address 172.16.22.2/24
/ interface ethernet-1/3 subinterface 0 ipv4 address 172.16.23.2/24
/ network-instance default admin-state enable
/ network-instance default interface ethernet-1/1.0
/ network-instance default interface ethernet-1/2.0
/ network-instance default interface ethernet-1/3.0
/interface ethernet-1/1 subinterface 0 ipv4 admin-state enable
/interface ethernet-1/2 subinterface 0 ipv4 admin-state enable
/interface ethernet-1/3 subinterface 0 ipv4 admin-state enable
/ routing-policy {
  policy all {
    default-action {
      policy-result accept
    }
  }
}
/ network-instance default protocols
bgp {
  autonomous-system 65000
  router-id 10.0.1.2
  group underlay {
    export-policy all
    import-policy all
    afi-safi ipv4-unicast {
      admin-state enable
    }
    afi-safi evpn {
      admin-state disable
    }
  }
  neighbor 172.16.21.1 {
    peer-as 65101
    peer-group underlay
  }
  neighbor 172.16.22.1 {
    peer-as 65102
    peer-group underlay
  }
  neighbor 172.16.23.1 {
    peer-as 65103
    peer-group underlay
  }
  afi-safi ipv4-unicast {
    admin-state enable
  }
}
/ interface system0 {
  admin-state enable
  subinterface 0 {
    admin-state enable
    ipv4 {
      admin-state enable
      address 10.0.1.2/32 {
      }
    }
  }
}
/ network-instance default interface system0.0

# clab-evpn1-leaf1
/ interface ethernet-1/49 subinterface 0 ipv4 address 172.16.11.1/24
/ interface ethernet-1/50 subinterface 0 ipv4 address 172.16.21.1/24
/ network-instance default admin-state enable
/ network-instance default interface ethernet-1/49.0
/ network-instance default interface ethernet-1/50.0
/interface ethernet-1/49 subinterface 0 ipv4 admin-state enable
/interface ethernet-1/50 subinterface 0 ipv4 admin-state enable
/ routing-policy {
  policy all {
    default-action {
      policy-result accept
    }
  }
}
/ network-instance default protocols
bgp {
  autonomous-system 65101
  router-id 10.0.0.1
  group underlay {
    peer-as 65000
    export-policy all
    import-policy all
    afi-safi ipv4-unicast {
      admin-state enable
    }
    afi-safi evpn {
      admin-state disable
    }
  }
  neighbor 172.16.11.2 {
    peer-group underlay
  }
  neighbor 172.16.21.2 {
    peer-group underlay
  }
  afi-safi ipv4-unicast {
    admin-state enable
    multipath {
      max-paths-level-1 2
    }
  }
  group overlay {
    export-policy all
    import-policy all
    peer-as 100
    local-as as-number 100 
    afi-safi ipv4-unicast {
      admin-state disable
    }
    afi-safi evpn {
      admin-state enable
    }
  }
  neighbor 10.0.1.1 {
    peer-group overlay
  }
}
/ interface system0 {
  admin-state enable
  subinterface 0 {
    admin-state enable
    ipv4 {
      admin-state enable
      address 10.0.0.1/32 {
      }
    }
  }
}
/ network-instance default interface system0.0
/ tunnel-interface vxlan1 {
  vxlan-interface 1 {
    type bridged
    ingress {
      vni 11
    }
  }
}
/ interface ethernet-1/1 {
  subinterface 0 {
    type bridged
  }
}
/ network-instance vrf-blue {
  type mac-vrf
  interface ethernet-1/1.0 {
  }
  vxlan-interface vxlan1.1 {
  }
  protocols {
    bgp-evpn {
      bgp-instance 1 {
        vxlan-interface vxlan1.1
        evi 111
      }
    }
    bgp-vpn {
      bgp-instance 1 {
        route-target {
          export-rt target:100:111
          import-rt target:100:111
        }
      }
    }
  }
}
commit stay

# clab-evpn1-leaf2
/ interface ethernet-1/49 subinterface 0 ipv4 address 172.16.12.1/24
/ interface ethernet-1/50 subinterface 0 ipv4 address 172.16.22.1/24
/ network-instance default admin-state enable
/ network-instance default interface ethernet-1/49.0
/ network-instance default interface ethernet-1/50.0
/interface ethernet-1/49 subinterface 0 ipv4 admin-state enable
/interface ethernet-1/50 subinterface 0 ipv4 admin-state enable
/ routing-policy {
  policy all {
    default-action {
      policy-result accept
    }
  }
}
/ network-instance default protocols
bgp {
  autonomous-system 65102
  router-id 10.0.0.2
  group underlay {
    peer-as 65000
    export-policy all
    import-policy all
    afi-safi ipv4-unicast {
      admin-state enable
    }
    afi-safi evpn {
      admin-state disable
    }
  }
  neighbor 172.16.12.2 {
    peer-group underlay
  }
  neighbor 172.16.22.2 {
    peer-group underlay
  }
  afi-safi ipv4-unicast {
    admin-state enable
    multipath {
      max-paths-level-1 2
    }
  }
  group overlay {
    export-policy all
    import-policy all
    peer-as 100
    local-as as-number 100 
    afi-safi ipv4-unicast {
      admin-state disable
    }
    afi-safi evpn {
      admin-state enable
    }
  }
  neighbor 10.0.1.1 {
    peer-group overlay
  }
}
/ interface system0 {
  admin-state enable
  subinterface 0 {
    admin-state enable
    ipv4 {
      admin-state enable
      address 10.0.0.2/32 {
      }
    }
  }
}
/ network-instance default interface system0.0

# clab-evpn1-leaf3
/ interface ethernet-1/49 subinterface 0 ipv4 address 172.16.13.1/24
/ interface ethernet-1/50 subinterface 0 ipv4 address 172.16.23.1/24
/ network-instance default admin-state enable
/ network-instance default interface ethernet-1/49.0
/ network-instance default interface ethernet-1/50.0
/interface ethernet-1/49 subinterface 0 ipv4 admin-state enable
/interface ethernet-1/50 subinterface 0 ipv4 admin-state enable
/ routing-policy {
  policy all {
    default-action {
      policy-result accept
    }
  }
}
/ network-instance default protocols
bgp {
  autonomous-system 65103
  router-id 10.0.0.3
  group underlay {
    peer-as 65000
    export-policy all
    import-policy all
    afi-safi ipv4-unicast {
      admin-state enable
    }
    afi-safi evpn {
      admin-state disable
    }
  }
  neighbor 172.16.13.2 {
    peer-group underlay
  }
  neighbor 172.16.23.2 {
    peer-group underlay
  }
  afi-safi ipv4-unicast {
    admin-state enable
    multipath {
      max-paths-level-1 2
    }
  }
  group overlay {
    export-policy all
    import-policy all
    peer-as 100
    local-as as-number 100 
    afi-safi ipv4-unicast {
      admin-state disable
    }
    afi-safi evpn {
      admin-state enable
    }
  }
  neighbor 10.0.1.1 {
    peer-group overlay
  }
}
/ interface system0 {
  admin-state enable
  subinterface 0 {
    admin-state enable
    ipv4 {
      admin-state enable
      address 10.0.0.3/32 {
      }
    }
  }
}
/ network-instance default interface system0.0
/ tunnel-interface vxlan1 {
  vxlan-interface 1 {
    type bridged
    ingress {
      vni 11
    }
  }
}
/ interface ethernet-1/1 {
  subinterface 0 {
    type bridged
  }
}
/ network-instance vrf-blue {
  type mac-vrf
  interface ethernet-1/1.0 {
  }
  vxlan-interface vxlan1.1 {
  }
  protocols {
    bgp-evpn {
      bgp-instance 1 {
        vxlan-interface vxlan1.1
        evi 111
      }
    }
    bgp-vpn {
      bgp-instance 1 {
        route-target {
          export-rt target:100:111
          import-rt target:100:111
        }
      }
    }
  }
}
commit stay

# clab-evpn1-server11
# clab-evpn1-server13
# clab-evpn1-server21
# clab-evpn1-server22
# clab-evpn1-server23
